---
title: "Data Related Stuff"
author: "Dean Gladish"
date: "July 28, 2019"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggthemes)
```


This R Markdown is just an inquiry into the statistics and facts surrounding data breaches in the United States.  Unlike the more traditional form of just summarizing the laws I wanted to create a document which would also give some helpful statistics which could be updated immediately.  

## Let's Begin


\ \ \ \ \ \ \ This shiny app is intended to do just that.  

```{r Load and wrangle data, message = FALSE, warning = FALSE, echo = FALSE}
library(readr)

statesData <- read_csv("statesSimplified.csv")


# Remove unneeded columns
statesData <- subset(statesData, select = c(1:13))

# Replace all NA values with the integer 0
statesData[is.na(statesData)] <- 0


library(ggplot2)




ggplot(data = statesData, mapping = aes(x = modifiedLawsin2018or2019, fill = modifiedLawsin2018or2019)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Did not modify laws 2018-2019", "Modified laws 2018-2019"))
  
ggplot(statesData) + 
  geom_bar(mapping = aes(x = reorder(State, thresholdNotifyAG), y = thresholdNotifyAG), stat = "identity") + 
  xlab("State") + 
  theme(panel.background = element_blank()) + 
  theme(axis.ticks = element_blank()) + 
  labs(title = "States and Threshold", y = "To Notify the Attorney General") + 
  geom_hline(yintercept = seq(0, 1000, by = 250), colour = "gray", size = 1, linetype = 21) + 
  coord_flip() + 
  theme(axis.text.y = element_text(size = 7))


```

`r statesData[1,]`

```{r Shiny App for Data Breach Laws, echo = FALSE}
library(shiny)

axis_vars <- c(
  "Modified its Laws in 2018-2019" = "modifiedLawsin2018or2019", 
  "With DOB as PI" = "hasDOBasPI", 
  "With Online (vs. financial) account as PI" = "hasOnlineAccountsasPI", 
  "\"access\" vs. acquisition" = "requiresAcquisitionNotJustAccess", 
  "Harm analysis allowed or not" = "harmAnalysisAllowed", 
  "Government Involvement or not" = "governmentInvolvementRequired", 
  "Reporting threshold: number of individuals to notify Attorney General" = "thresholdNotifyAG",
  "Reporting threshold: number of individuals to notify consumer reporting agency" = "thresholdNotifyCRA", 
  "Time Frame within which to notify" = "timeFrame", 
  "Requirement for \"service provider\" to report to data owner immediately or not" = "serviceProvidersNotifyImmediately", 
  "Harm analysis required or not" = "harmAnalysisRequired", 
  "With Financial (vs. online) account as PI" = "financialAccountInformationisPI"
)

inputPanel(
  selectInput("testInput", label = "test input label", choices = axis_vars, 
              selected = "hasDOBasPI"),
  sliderInput("testInput2", "test input label 2",
              0, 1000, c(0, 1000), step = 1)
) 



library(stringr)

sidebarLayout(
    sidebarPanel(
      helpText("Create demographic maps with 
               information from the 2010 US Census."),
      
      selectInput("var", 
                  label = "Choose a variable to display",
                  choices = c("all states" = paste(":", toString(statesData$State), sep = "<br/>"),
                    "modifiedLawsin2018or2019" = paste(" which modified their laws in 2018 or 2019:", toString(statesData[which(statesData$modifiedLawsin2018or2019),]$State), sep = "<br/>"), 
                              "hasDOBasPI" = paste(" which have date of birth as personal information:", toString(statesData[which(statesData$hasDOBasPI),]$State), sep = "<br/>")),
                  selected = "Percent White"),
      
      sliderInput("range", 
                  label = "Range of interest:",
                  min = 0, max = 100, value = c(0, 100))
    ),
    
    mainPanel(
      textOutput("selected_var"),
      textOutput("min_max")
    )
  )
renderUI({
  HTML(str_replace_all(toString(input$var), ", ", "<br/>"))
  
})


renderText({ 
    paste("You have chosen a range that goes from",
          input$range[1], "to", input$range[2])
  })

```












