---
title: "Data Breach Notification Laws"
author: "Dean Gladish"
date: "July 31, 2019"
output:
  rmdformats::readthedown:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: tango
    css: custom.css
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggthemes)
library(shinyWidgets)
library(shinythemes)
library(shinythemes)

library(knitr)

```

***

## Let's Begin

***
This R Markdown is just an inquiry into the statistics and facts surrounding data breaches in the United States.  Unlike the more traditional form of just summarizing the laws I wanted to create a document which would also give some helpful statistics which could be updated immediately.  





\ \ \ \ \ \ \ This shiny app is intended to do just that.  

```{r Load and wrangle data, message = FALSE, warning = FALSE, echo = FALSE}


library(readr)

statesData <- read_csv("statesSimplified.csv")


# Remove unneeded columns
statesData <- subset(statesData, select = c(1:13))

# Replace all NA values with the integer 0
statesData[is.na(statesData)] <- 0


library(ggplot2)



statesData$placeHolderColumn <- c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE)




```

***


## Filtering States


***
```{r Shiny App for Data Breach Laws, echo = FALSE}
library(shiny)


# CSS Code for making the buttons look better
css <- 
"
a#more-apps-by-dean {
display: none;
}
body {
background: #fff;
}
.container {
margin: 0;
padding: 0px;
}
.green {
background: green;
}
#expr-container .selectize-input {
  font-size: 12px;
line-height: 12px;
}
#expr-container .selectize-dropdown {
font-size: 12px;
line-height: 12px;
}
#expr-container .selectize-dropdown-content {
max-height: 225px;
padding: 0;
}
#expr-container .selectize-dropdown-content .option {
border-bottom: 0px dotted #ccc;
}
#submitExpr {
font-weight: bold;
font-size: 12px;
padding: 0px 0px;
}
#helpText {
font-size: 12px;
}
#btn {
font-size: 12px;
}
"





axis_vars <- c(
  "Modified its Laws in 2018-2019" = "modifiedLawsin2018or2019", 
  "With DOB as PI" = "hasDOBasPI", 
  "With Online (vs. financial) account as PI" = "hasOnlineAccountsasPI", 
  "\"access\" vs. acquisition" = "requiresAcquisitionNotJustAccess", 
  "Harm analysis allowed or not" = "harmAnalysisAllowed", 
  "Government Involvement or not" = "governmentInvolvementRequired", 
  "Reporting threshold: number of individuals to notify Attorney General" = "thresholdNotifyAG",
  "Reporting threshold: number of individuals to notify consumer reporting agency" = "thresholdNotifyCRA", 
  "Time Frame within which to notify" = "timeFrame", 
  "Requirement for \"service provider\" to report to data owner immediately or not" = "serviceProvidersNotifyImmediately", 
  "Harm analysis required or not" = "harmAnalysisRequired", 
  "With Financial (vs. online) account as PI" = "financialAccountInformationisPI"
)





library(stringr)







#sidebarLayout
sidebarLayout(
  
  #sidebarPanel
    inputPanel(
  
      helpText("Filter States by the Following Criteria."),
      
     
      selectInput("var", 
                  label = "Choose variables to display",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var2", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var3", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var4", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var5", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var6", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var7", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var8", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      selectInput("var9", 
                  label = "",
                  choices = c(" " = toString(which(statesData$placeHolderColumn)),
                    "Modified its laws in 2018 or 2019" = toString(which(statesData$modifiedLawsin2018or2019)), "Date of Birth is PI" = toString(which(statesData$hasDOBasPI)), "Online Accounts are PI" = toString(which(statesData$hasOnlineAccountsasPI)), 
                  "Acquisition instead of just access counts as a data breach" = toString(which(statesData$requiresAcquisitionNotJustAccess)), 
                  "Harm Analysis is Allowed" = toString(which(statesData$harmAnalysisAllowed)),
                  "Government Involvement is Required" = toString(which(statesData$governmentInvolvementRequired)),
                  "Service Providers need to notify consumers immediately" = toString(which(statesData$serviceProvidersNotifyImmediately)), 
                  "Harm Analysis is Required" = toString(which(statesData$harmAnalysisRequired)),
                  "Information about Financial Accounts is PI" = toString(which(statesData$hasOnlineAccountsasPI))), 
                  selected = "all states"),
      
      sliderInput("range", 
                  label = "Range of Attorney General Notification Thresholds:",
                  min = min(statesData$thresholdNotifyAG), max = max(statesData$thresholdNotifyAG), value = c(min(statesData$thresholdNotifyAG), max(statesData$thresholdNotifyAG)), step = NULL)
    ,
    sliderInput("range2", 
                  label = "Range of Consumer Reporting Agency Notification Thresholds:",
                  min = min(statesData$thresholdNotifyCRA), max = max(statesData$thresholdNotifyCRA), value = c(min(statesData$thresholdNotifyCRA), max(statesData$thresholdNotifyCRA)), step = NULL)
    ,
sliderInput("range3", 
                  label = "Time Frame for making notifications:",
                  min = min(statesData$timeFrame), max = max(statesData$timeFrame), value = c(min(statesData$timeFrame), max(statesData$timeFrame)), step = NULL)
    ),
    
    mainPanel(
      textOutput("selected_var"),
      textOutput("min_max")
    )
  )



renderUI({
 
  HTML(str_replace_all(toString(
    paste(toString(statesData[
      
      intersect( #Variable 9
        
        as.integer(unlist(strsplit(input$var9, split = ", "))),
      
      intersect( #Variable 8
        
        as.integer(unlist(strsplit(input$var8, split = ", "))),
      
      intersect( #Variable 7
        
        as.integer(unlist(strsplit(input$var7, split = ", "))),
      
      intersect( #Variable 6
        
        as.integer(unlist(strsplit(input$var6, split = ", "))),
      
      intersect( #Variable 5
        
        as.integer(unlist(strsplit(input$var5, split = ", "))),
      
      intersect( #Variable 4
        
        as.integer(unlist(strsplit(input$var4, split = ", "))),
      
      intersect( #Variable 3
        
        as.integer(unlist(strsplit(input$var3, split = ", "))),
      
      intersect( #Variable 2
        
        as.integer(unlist(strsplit(input$var2, split = ", "))),
      
      
      intersect( #Variable 1
      
      as.integer(unlist(strsplit(input$var, split = ", "))), 
      
      
      #
      intersect(intersect(which(statesData$timeFrame >= input$range3[1]), which(statesData$timeFrame <= input$range3[2])), # Range 3
      
      intersect(
        
        
        intersect(which(statesData$thresholdNotifyAG >= input$range[1]), which(statesData$thresholdNotifyAG <= input$range[2])), # Range 1
        
        intersect(which(statesData$thresholdNotifyCRA >= input$range2[1]), which(statesData$thresholdNotifyCRA <= input$range2[2])) # Range 2
        
        
      )
      
      )
      
      #
      
      
      
      
      
      )
      
      )
      
      )
      
      )
      
      )
      
      )
      
      )
      
      )
      
      )
      
      ,]$State))
    )
    , ", ", "<br/>"))
})



#-------------------------------------------------------------------------------------------


```

***

## Reporting Thresholds and Time Frame

***


```{r, message = F, warning = F, echo = F}





axis_vars_graph2 <- c(
  "Reporting threshold: number of individuals to notify Attorney General" = "thresholdNotifyAG",
  "Reporting threshold: number of individuals to notify consumer reporting agency" = "thresholdNotifyCRA", 
  "Time Frame within which to notify" = "timeFrame"
)
fluidRow(
  shinyjs::useShinyjs(),
  tags$style(css),
  div(id = "expr-container",
  
  selectInput("yvar", label = "Y-axis variable", choices = axis_vars_graph2, 
              selected = "Cost_of_Revenue", width = "600px")
)
)

# This part is not the best way to code this.  How else can this be done (for example, by using aes_string instead of aes)?  
renderPlot({
  if (input$yvar == "thresholdNotifyAG") {
    ggplot(statesData) + 
  geom_bar(mapping = aes(x = reorder(State, thresholdNotifyAG), y = thresholdNotifyAG), stat = "identity") + 
  xlab("State") + 
  theme(panel.background = element_blank()) + 
  theme(axis.ticks = element_blank()) + 
  labs(title = "States and Threshold", y = "To Notify Attorney General") + 
  geom_hline(yintercept = seq(0, 1000, by = 250), colour = "gray", size = 1, linetype = 21) + 
  coord_flip() + 
  theme(axis.text.y = element_text(size = 7))
  }
  
  else if (input$yvar == "thresholdNotifyCRA") {
    ggplot(statesData) + 
  geom_bar(mapping = aes(x = reorder(State, thresholdNotifyCRA), y = thresholdNotifyCRA), stat = "identity") + 
  xlab("State") + 
  theme(panel.background = element_blank()) + 
  theme(axis.ticks = element_blank()) + 
  labs(title = "States and Threshold", y = "To Notify Consumer Reporting Agencies") + 
  geom_hline(yintercept = seq(0, 10000, by = 1000), colour = "gray", size = 1, linetype = 21) + 
  coord_flip() + 
  theme(axis.text.y = element_text(size = 7))
  }
  
  else if (input$yvar == "timeFrame") {
    ggplot(statesData) + 
  geom_bar(mapping = aes(x = reorder(State, timeFrame), y = timeFrame), stat = "identity") + 
  xlab("State") + 
  theme(panel.background = element_blank()) + 
  theme(axis.ticks = element_blank()) + 
  labs(title = "States and Threshold", y = "How Long to Disclose") + 
  geom_hline(yintercept = seq(0, 100, by = 10), colour = "gray", size = 1, linetype = 21) + 
  coord_flip() + 
  theme(axis.text.y = element_text(size = 7))
  }
})




```

***

## Proportions of States Which Have Enacted Regulations

***


```{r, message = F, warning = F, echo = F}






axis_vars_graphProportions <- c(
  "Modified Laws in 2018 or 2019" = "modifiedLawsin2018or2019", 
  "Date of Birth is Considered to be Personal Information" = "hasDOBasPI",
  "Online Accounts are Personal Information" = "hasOnlineAccountsasPI",
  "Definition of Data Breach Requires Acquisition (not just access)" = "requiresAcquisitionNotJustAccess", 
  "Harm Analysis is Allowed" = "harmAnalysisAllowed", 
  "Government Involvement is Required" = "governmentInvolvementRequired",
  "Service Providers shall be Notified Immediately" = "serviceProvidersNotifyImmediately",
  "Harm Analysis is Required" = "harmAnalysisRequired", 
  "Financial Account Information is Personal Information" = "financialAccountInformationisPI"
)
fluidRow(
  shinyjs::useShinyjs(),
  tags$style(css),
  div(id = "expr-container",
  
  selectInput("zvar", label = "Variable", choices = axis_vars_graphProportions, 
              selected = "Cost_of_Revenue", width = "600px")
  )
)

# Again, this part is not the best way to code this.  How else can this be done without hardcoding all the graphs?  
renderPlot({
  if (input$zvar == "modifiedLawsin2018or2019"){
    ggplot(data = statesData, mapping = aes(x = modifiedLawsin2018or2019, fill = modifiedLawsin2018or2019)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Did not modify laws 2018-2019", "Modified laws 2018-2019"))
  }
  
  else if (input$zvar == "hasDOBasPI") {
    ggplot(data = statesData, mapping = aes(x = hasDOBasPI, fill = hasDOBasPI)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Date of Birth is not PI", "Date of Birth is PI"))
  }
  
  else if (input$zvar == "hasOnlineAccountsasPI") {
    ggplot(data = statesData, mapping = aes(x = hasOnlineAccountsasPI, fill = hasOnlineAccountsasPI)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Online Accounts are not PI", "Online Accounts are PI"))
  }
  
  else if (input$zvar == "requiresAcquisitionNotJustAccess") {
    ggplot(data = statesData, mapping = aes(x = requiresAcquisitionNotJustAccess, fill = requiresAcquisitionNotJustAccess)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Access", "Acquisition"))
  }
  
  else if (input$zvar == "harmAnalysisAllowed") {
    ggplot(data = statesData, mapping = aes(x = harmAnalysisAllowed, fill = harmAnalysisAllowed)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Harm Analysis Not Allowed", "Harm Analysis Allowed"))
  }
  
  else if (input$zvar == "governmentInvolvementRequired") {
    ggplot(data = statesData, mapping = aes(x = governmentInvolvementRequired, fill = governmentInvolvementRequired)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Government Involvement is Required", "Government Involvement is Not Required"))
  }
  
  else if (input$zvar == "serviceProvidersNotifyImmediately") {
    ggplot(data = statesData, mapping = aes(x = serviceProvidersNotifyImmediately, fill = serviceProvidersNotifyImmediately)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Service Providers do not need to immediately notify", "Service Providers need to immediately notify"))
  }
  
  else if (input$zvar == "harmAnalysisRequired") {
    ggplot(data = statesData, mapping = aes(x = harmAnalysisRequired, fill = harmAnalysisRequired)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Harm Analysis is Not Required", "Harm Analysis is Required"))
  }
  
  else if (input$zvar == "financialAccountInformationisPI") {
    ggplot(data = statesData, mapping = aes(x = financialAccountInformationisPI, fill = financialAccountInformationisPI)) + 
  geom_bar() + 
  labs(title = "Proportion of States", x = "", y = "Number of States") + 
  theme(panel.background = element_blank()) + 
  geom_hline(yintercept = seq(0, 50, by = 10), col = "white", lwd = 1) + 
  theme(axis.text.y = element_blank(), axis.ticks = element_blank()) +
  geom_text(aes(label=..count..), stat="count", position = position_stack(), vjust = 1.5, color = "white") + 
  theme(legend.position = "none") + 
  scale_x_discrete(limit = c("FALSE", "TRUE"),
                     labels = c("Financial Account Information is Not PI", "Financial Account Information is PI"))
  }

})



  
```

***
## Reference Table
***

```{r, message = F, warning = F, echo = F}
statesDataPresentable <- statesData

colnames(statesDataPresentable) <- c("State", "Modified 2018-2019", "DOB is PI", "Online Accounts are PI", "Acquisition", "Harm Analysis Allowed", "Government Involvement Required", "Notify AG", "Notify CRA", "Time Frame", "Notify SP Immediately", "Harm Analysis Required", "Financial Account Information is PI", "Is a State")

statesDataPresentable <- statesDataPresentable[,-ncol(statesDataPresentable)]

statesDataPresentable$`Modified 2018-2019` <- ifelse(statesDataPresentable$`Modified 2018-2019` == "TRUE", "X", "")

statesDataPresentable$`DOB is PI` <- ifelse(statesDataPresentable$`DOB is PI` == "TRUE", "X", "")

statesDataPresentable$`Online Accounts are PI` <- ifelse(statesDataPresentable$`Online Accounts are PI` == "TRUE", "X", "")

statesDataPresentable$Acquisition <- ifelse(statesDataPresentable$Acquisition == "TRUE", "X", "")

statesDataPresentable$`Harm Analysis Allowed` <- ifelse(statesDataPresentable$`Harm Analysis Allowed` == "TRUE", "X", "")

statesDataPresentable$`Government Involvement Required` <- ifelse(statesDataPresentable$`Government Involvement Required` == "TRUE", "X", "")

statesDataPresentable$`Notify SP Immediately` <- ifelse(statesDataPresentable$`Notify SP Immediately` == "TRUE", "X", "")

statesDataPresentable$`Harm Analysis Required` <- ifelse(statesDataPresentable$`Harm Analysis Required` == "TRUE", "X", "")

statesDataPresentable$`Financial Account Information is PI` <- ifelse(statesDataPresentable$`Financial Account Information is PI` == "TRUE", "X", "")


library(knitr)
library(kableExtra)
statesDataPresentable %>% kable() %>% kable_styling() %>% kable_styling(bootstrap_options = c( "scale_down", "hover", "condensed", "responsive", full_width = F), latex_options = c( "scale_down", "hover", "condensed", "responsive", full_width = F), font_size = 12)

# This doesn't really work
library(grid)
library(gridExtra)




```



&nbsp;
<hr />
<p style="text-align: center;">By <a href="https://github.com/gladishd/">Dean Gladish</a></p>
<p style="text-align: center;"><span style="color: #808080;"><em>gladish.dean@gmail.com</em></span></p>

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">



&nbsp;


